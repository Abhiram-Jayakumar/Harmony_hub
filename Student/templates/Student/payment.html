<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Page - HARMONY HUB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #FFD700;
            --dark-color: #121212;
            --light-color: #f5f5f5;
            --accent-color: #FFD700;
            --success-color: #28a745;
        }
        
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background-color: var(--dark-color);
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .navbar-brand {
            color: var(--primary-color) !important;
            font-weight: bold;
            font-size: 24px;
            letter-spacing: 1px;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .nav-links a {
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        .nav-links a:hover {
            background-color: rgba(255, 215, 0, 0.2);
            transform: translateY(-2px);
        }
        
        .page-header {
            color: var(--dark-color);
            border-bottom: 3px solid var(--primary-color);
            display: inline-block;
            padding-bottom: 5px;
            margin-bottom: 30px;
        }
        
        .payment-container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .booking-card {
            background-color: white;
            border-radius: 15px;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 25px;
        }
        
        .booking-header {
            background-color: var(--dark-color);
            color: var(--light-color);
            padding: 20px;
            position: relative;
        }
        
        .booking-accent {
            position: absolute;
            height: 100%;
            width: 8px;
            background-color: var(--primary-color);
            left: 0;
            top: 0;
        }
        
        .booking-content {
            padding: 25px;
        }
        
        .booking-info {
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        
        .info-row {
            display: flex;
            margin-bottom: 10px;
        }
        
        .info-label {
            font-weight: bold;
            color: var(--dark-color);
            width: 150px;
            display: inline-block;
        }
        
        .info-value {
            color: #555;
        }
        
        .price-tag {
            background-color: var(--primary-color);
            color: var(--dark-color);
            font-weight: bold;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
            font-size: 18px;
        }
        
        .payment-form {
            background-color: white;
            border-radius: 15px;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .payment-header {
            background-color: var(--dark-color);
            color: var(--light-color);
            padding: 20px;
            position: relative;
        }
        
        .payment-accent {
            position: absolute;
            height: 100%;
            width: 8px;
            background-color: var(--primary-color);
            left: 0;
            top: 0;
        }
        
        .payment-content {
            padding: 25px;
        }
        
        .credit-card {
            background: linear-gradient(45deg, #000000, #333333);
            border-radius: 15px;
            padding: 20px;
            color: white;
            margin-bottom: 25px;
            min-height: 200px;
            position: relative;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .card-chip {
            background: var(--primary-color);
            width: 50px;
            height: 40px;
            border-radius: 8px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .card-chip::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 50%;
            background: rgba(255,255,255,0.2);
            top: 0;
            left: 0;
        }
        
        .card-number {
            font-size: 22px;
            letter-spacing: 4px;
            margin-bottom: 20px;
            color: var(--primary-color);
            font-family: monospace;
        }
        
        .card-details {
            display: flex;
            justify-content: space-between;
        }
        
        .card-holder, .card-expiry {
            font-size: 14px;
            text-transform: uppercase;
        }
        
        .card-label {
            font-size: 10px;
            opacity: 0.8;
        }
        
        .card-network {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .form-control {
            border-radius: 8px;
            padding: 12px;
            border: 1px solid #ddd;
            margin-bottom: 15px;
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(255, 215, 0, 0.25);
        }
        
        .btn-success {
            background-color: var(--dark-color);
            border-color: var(--dark-color);
            color: var(--primary-color);
            transition: all 0.3s ease;
            padding: 12px 30px;
            font-weight: 600;
            border-radius: 8px;
        }
        
        .btn-success:hover {
            background-color: #000;
            border-color: #000;
            color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .btn-secondary {
            background-color: #6c757d;
            transition: all 0.3s ease;
            border-radius: 8px;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }
        
        .secure-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            color: #6c757d;
            font-size: 14px;
        }
        
        .secure-badge svg {
            margin-right: 10px;
            fill: #6c757d;
        }
        
        /* Form feedback styles */
        .is-valid {
            border-color: var(--success-color);
        }
        
        .is-invalid {
            border-color: #dc3545;
        }
        
        .invalid-feedback {
            color: #dc3545;
            font-size: 12px;
            margin-top: -10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="{% url 'Student:student_home' %}">HARMONY HUB</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <div class="nav-links">
                    <a href="{% url 'Student:student_profile'%}" style="color: #f5f5f5;">Student Profile</a>
                    <a href="{% url 'Student:search_teachers'%}" style="color: #f5f5f5;">Search Teachers</a>
                    <a href="{% url 'Student:student_bookings'%}" style="color: white;">My Bookings</a>
                    <a href="{% url 'Student:login'%}" style="color: #FFD700;">Logout</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container payment-container">
        <h2 class="page-header text-center">Complete Your Payment</h2>
        
        <div class="booking-card">
            <div class="booking-header">
                <div class="booking-accent"></div>
                <h4>Booking Details</h4>
            </div>
            <div class="booking-content">
                <div class="booking-info">
                    <div class="info-row">
                        <span class="info-label">Music Section:</span>
                        <span class="info-value">{{ booking.music_section.instrument }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Teacher:</span>
                        <span class="info-value">{{ booking.teacher.name }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Date:</span>
                        <span class="info-value">{{ booking.booking_date }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Time:</span>
                        <span class="info-value">{{ booking.time_slot }}</span>
                    </div>
                </div>
                <div class="text-end">
                    <span class="price-tag">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-tag-fill me-1" viewBox="0 0 16 16">
                            <path d="M2 1a1 1 0 0 0-1 1v4.586a1 1 0 0 0 .293.707l7 7a1 1 0 0 0 1.414 0l4.586-4.586a1 1 0 0 0 0-1.414l-7-7A1 1 0 0 0 6.586 1zm4 3.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
                        </svg>
                        ${{ booking.music_section.rate_per_hour }}
                    </span>
                </div>
            </div>
        </div>
        
        <div class="payment-form">
            <div class="payment-header">
                <div class="payment-accent"></div>
                <h4>Payment Information</h4>
            </div>
            <div class="payment-content">
                <form action="{% url 'Student:payment_processing' booking.id %}" method="POST" id="paymentForm">
                    {% csrf_token %}
                    
                    <div class="credit-card">
                        <div class="card-network">VISA</div>
                        <div class="card-chip"></div>
                        <div class="card-number" id="cardNumberDisplay">•••• •••• •••• ••••</div>
                        <div class="card-details">
                            <div class="card-holder">
                                <div class="card-label">CARD HOLDER</div>
                                <div id="cardHolderDisplay">YOUR NAME</div>
                            </div>
                            <div class="card-expiry">
                                <div class="card-label">EXPIRES</div>
                                <div id="cardExpiryDisplay">MM/YY</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-12">
                            <label for="cardName" class="form-label">Cardholder Name</label>
                            <input type="text" class="form-control" id="cardName" placeholder="Name on card" required>
                            <div class="invalid-feedback">
                                Please provide the cardholder name
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-12">
                            <label for="cardNumber" class="form-label">Card Number</label>
                            <input type="text" class="form-control" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" required>
                            <div class="invalid-feedback">
                                Please enter a valid card number
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="expiryDate" class="form-label">Expiration Date</label>
                            <input type="text" class="form-control" id="expiryDate" placeholder="MM/YY" maxlength="5" required>
                            <div class="invalid-feedback">
                                Please provide a valid expiration date
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="cvv" class="form-label">CVV</label>
                            <input type="text" class="form-control" id="cvv" placeholder="123" maxlength="3" required>
                            <div class="invalid-feedback">
                                Please enter the 3-digit security code
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-12">
                            <label for="billingAddress" class="form-label">Billing Address</label>
                            <input type="text" class="form-control" id="billingAddress" placeholder="Street address" required>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="city" placeholder="City" required>
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control" id="state" placeholder="State" required>
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control" id="zip" placeholder="Zip" required>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12 text-center">
                            <button type="submit" class="btn btn-success btn-lg">Pay ${{ booking.music_section.rate_per_hour }}</button>
                        </div>
                    </div>
                    
                    <div class="secure-badge">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-shield-lock" viewBox="0 0 16 16">
                            <path d="M5.338 1.59a61 61 0 0 0-2.837.856.48.48 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.7 10.7 0 0 0 2.287 2.233c.346.244.652.42.893.533q.18.085.293.118a1 1 0 0 0 .866 0q.114-.034.294-.118c.24-.113.547-.29.893-.533a10.7 10.7 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067c-.53 0-1.552.223-2.662.524zM5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.8 11.8 0 0 1-2.517 2.453 7.3 7.3 0 0 1-.989.596l-.172.075a1.96 1.96 0 0 1-.843.061l-.217-.066a7.3 7.3 0 0 1-.989-.596 11.8 11.8 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 63 63 0 0 1 5.072.56z"/>
                            <path d="M9.5 6.5a1.5 1.5 0 0 1-1 1.415l.385 1.99a.5.5 0 0 1-.491.595h-.788a.5.5 0 0 1-.49-.595l.384-1.99a1.5 1.5 0 1 1 2-1.415z"/>
                        </svg>
                        Secure Payment Processing
                    </div>
                </form>
            </div>
        </div>
        
        <div class="text-center mt-4 mb-5">
            <a href="{% url 'Student:student_bookings' %}" class="btn btn-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left me-1" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"/>
                </svg>
                Back to My Bookings
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Card form interactive features
        document.addEventListener('DOMContentLoaded', function() {
            const cardNumber = document.getElementById('cardNumber');
            const cardName = document.getElementById('cardName');
            const expiryDate = document.getElementById('expiryDate');
            const cvv = document.getElementById('cvv');
            
            const cardNumberDisplay = document.getElementById('cardNumberDisplay');
            const cardHolderDisplay = document.getElementById('cardHolderDisplay');
            const cardExpiryDisplay = document.getElementById('cardExpiryDisplay');
            
            // Format card number with spaces
            cardNumber.addEventListener('input', function(e) {
                let value = e.target.value;
                
                // Remove all non-digits
                value = value.replace(/\D/g, '');
                
                // Add spaces after every 4 digits
                let formattedValue = '';
                for (let i = 0; i < value.length; i++) {
                    if (i > 0 && i % 4 === 0) {
                        formattedValue += ' ';
                    }
                    formattedValue += value[i];
                }
                
                // Update the input value
                e.target.value = formattedValue;
                
                // Update the card display
                if (value.length > 0) {
                    let displayValue = '';
                    for (let i = 0; i < Math.min(value.length, 16); i++) {
                        if (i > 0 && i % 4 === 0) {
                            displayValue += ' ';
                        }
                        // Only show the last 4 digits
                        if (i < 12) {
                            displayValue += '•';
                        } else {
                            displayValue += value[i];
                        }
                    }
                    // Fill remaining with dots
                    for (let i = value.length; i < 16; i++) {
                        if (i > 0 && i % 4 === 0) {
                            displayValue += ' ';
                        }
                        displayValue += '•';
                    }
                    cardNumberDisplay.textContent = displayValue;
                } else {
                    cardNumberDisplay.textContent = '•••• •••• •••• ••••';
                }
                
                // Simple validation
                if (value.length === 16) {
                    cardNumber.classList.add('is-valid');
                    cardNumber.classList.remove('is-invalid');
                } else {
                    cardNumber.classList.remove('is-valid');
                    if (value.length > 0) cardNumber.classList.add('is-invalid');
                }
            });
            
            // Update cardholder name
            cardName.addEventListener('input', function(e) {
                let value = e.target.value.toUpperCase();
                
                if (value.length > 0) {
                    cardHolderDisplay.textContent = value;
                    cardName.classList.add('is-valid');
                    cardName.classList.remove('is-invalid');
                } else {
                    cardHolderDisplay.textContent = 'YOUR NAME';
                    cardName.classList.remove('is-valid');
                }
            });
            
            // Format expiry date
            expiryDate.addEventListener('input', function(e) {
                let value = e.target.value;
                
                // Remove all non-digits
                value = value.replace(/\D/g, '');
                
                // Format as MM/YY
                if (value.length > 0) {
                    let month = value.substring(0, 2);
                    let year = value.substring(2, 4);
                    
                    // Validate month
                    if (month.length === 1) {
                        if (parseInt(month) > 1) {
                            month = '0' + month;
                        }
                    } else if (month.length === 2) {
                        if (parseInt(month) > 12) {
                            month = '12';
                        }
                    }
                    
                    // Build formatted value
                    let formattedValue = month;
                    if (year.length > 0) {
                        formattedValue += '/' + year;
                    }
                    
                    e.target.value = formattedValue;
                    cardExpiryDisplay.textContent = formattedValue;
                    
                    // Validation
                    if (formattedValue.length === 5) {
                        expiryDate.classList.add('is-valid');
                        expiryDate.classList.remove('is-invalid');
                    } else {
                        expiryDate.classList.remove('is-valid');
                        if (formattedValue.length > 0) expiryDate.classList.add('is-invalid');
                    }
                } else {
                    cardExpiryDisplay.textContent = 'MM/YY';
                    expiryDate.classList.remove('is-valid');
                }
            });
            
            // Validate CVV
            cvv.addEventListener('input', function(e) {
                let value = e.target.value;
                
                // Remove all non-digits
                value = value.replace(/\D/g, '');
                e.target.value = value;
                
                // Validation
                if (value.length === 3) {
                    cvv.classList.add('is-valid');
                    cvv.classList.remove('is-invalid');
                } else {
                    cvv.classList.remove('is-valid');
                    if (value.length > 0) cvv.classList.add('is-invalid');
                }
            });
            
            // Form submission
            document.getElementById('paymentForm').addEventListener('submit', function(e) {
                let isValid = true;
                
                // Validate card name
                if (cardName.value.trim() === '') {
                    cardName.classList.add('is-invalid');
                    isValid = false;
                }
                
                // Validate card number
                if (cardNumber.value.replace(/\s/g, '').length !== 16) {
                    cardNumber.classList.add('is-invalid');
                    isValid = false;
                }
                
                // Validate expiry date
                if (expiryDate.value.length !== 5) {
                    expiryDate.classList.add('is-invalid');
                    isValid = false;
                }
                
                // Validate CVV
                if (cvv.value.length !== 3) {
                    cvv.classList.add('is-invalid');
                    isValid = false;
                }
                
                if (!isValid) {
                    e.preventDefault();
                }
            });
        });
    </script>
</body>
</html>